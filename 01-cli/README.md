[![Build Status](https://travis-ci.org/egor-bogomolov/software-design.svg?branch=01-cli)](https://travis-ci.org/egor-bogomolov/software-design)

# Описание

Интерпретатор командной строки, поддерживающий похожий на bash язык. 

## Язык

Функции, поддерживаемые самим интерпретатором:

* **cat [FILE]** &ndash; вывести содержимое файла

* **echo** &ndash; вывести на экран свои аргументы по одному на строке

* **wc [FILE]** &ndash; подсчитать число строк, слов и байт в файле

* **pwd** &ndash; распечатать текущую директорию

* **exit** &ndash; прекращение работы интерпретатора

* **varname=value** &ndash; сохранение значения переменной, в дальнейшем используется подставновкой **$varname**

* **command1 | command2** &ndash; пайплайны, перенаправляющие вывод одной команды на вход другой

* Одинарные и двойные кавычки

Остальные вызовы переадресовываются bash'у.

## Сущности

**CommandLineInterpretator** &ndash; обертка над **CommandLineExecutor**, реализующая взаимодействие с консольным интерфейсом.

**CommandLineExecutor** &ndash; интерфейс, принимает команды в виде строк, исполняет их и возвращает **ExecutionResult**

**ExecutionResult** &ndash; хранит результат исполнения, а именно вывод в выходной поток и поток ошибок и то, пытается ли исполнение завершиться

**BashLikeExecutor** &ndash; реализация **CommandLineExecutor** для описанного выше языка. Разбирает полученную строчку с помощью 
**BashLikeParser**, получает корень AST соответствующий коду и исполняет его

**Environment** &ndash; интерфейс хранилища переменных со значениями

**LocalMapEnvironment** &ndash; реализация **Environment** на основе Map

**CommandLineParser** &ndash; интерфейс парсера, разбирает строчки в синтаксические деревья, им соответствующие

**BashLikeParser** &ndash; реализация **CommandLineParser**, поддерживает кавычки, подстановки и пайпы. Сперва строка
разбирается на токены (неделимые строки) с учетом особенностей кавычек, затем токены дробятся по пайпам на списки,
организующиеся в будущие команды с аргументами. После при помощи **BashLikeProducer** из них строятся команды и соединяются
в дерево.

**CommandProducer** &ndash; интерфейс сущности, умеющей сохранять парсеры команд из токенов и затем
применять их в том же порядке, в котором они были сохранены.

**BashLikeProducer** &ndash; реализация **CommandProducer**

**AstNode** &ndash; вершина синтаксического дерева для описанного языка

## Вершины AST

**Assignment**, **Cat**, **Echo**, **Exit**, **Pwd**, **Wc** &ndash; вершины, соответствующие командам, наследуются от 
**Command**, абстрактного класса, реализующего общую для команд логику.

**TextNode** &ndash; вершина для хранения текста. Используется для аргументов команд.

**ExecuteNode** &ndash; вершина, оборачивающая команду, которая перенаправляется в bash.

## Архитектура
Старая архитектура:

<p align="center">
<img src="images/architecture-old.jpg" />
</p> 

Новая архитектура:

<p align="center">
<img src="images/architecture.jpg" />
</p> 

* Убрано деление на команды с аргументами и без
* Логика препроцессора перенесена в парсер
* От построения нескольких деревьев и последующей их обработки **BashLikeExecutor** перешли к построению одного AST на этапе парсера
